<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"right","display":"hide","offset":12,"onmobile":true},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="在Leetcode刷完了database下的所有免费题，尝试把这些题目按问题进行了分类，并梳理出每种问题的所涉MySQL知识点与解决思路。 数据提取与分析问题1 前几【涉及知识点】最值：单列最大max(column)，单列最小min(column)；多列最大greatest(column1,column2)，多列最小least(column1,column2)，注意greatest和least里不">
<meta name="keywords" content="MySQL,Database">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL Study Notes">
<meta property="og:url" content="http://yoursite.com/2020/01/10/notes-skill-database-mysql/index.html">
<meta property="og:site_name" content="Brielley">
<meta property="og:description" content="在Leetcode刷完了database下的所有免费题，尝试把这些题目按问题进行了分类，并梳理出每种问题的所涉MySQL知识点与解决思路。 数据提取与分析问题1 前几【涉及知识点】最值：单列最大max(column)，单列最小min(column)；多列最大greatest(column1,column2)，多列最小least(column1,column2)，注意greatest和least里不">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2021-03-23T08:13:59.078Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL Study Notes">
<meta name="twitter:description" content="在Leetcode刷完了database下的所有免费题，尝试把这些题目按问题进行了分类，并梳理出每种问题的所涉MySQL知识点与解决思路。 数据提取与分析问题1 前几【涉及知识点】最值：单列最大max(column)，单列最小min(column)；多列最大greatest(column1,column2)，多列最小least(column1,column2)，注意greatest和least里不">
  <link rel="canonical" href="http://yoursite.com/2020/01/10/notes-skill-database-mysql/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>MySQL Study Notes | Brielley</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Brielley</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-what's-new">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>What's New</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tech">
      
    

    <a href="/categories/Tech/" rel="section"><i class="fa fa-fw fa-keyboard-o"></i>Tech</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-game">
      
    

    <a href="/categories/Game/" rel="section"><i class="fa fa-fw fa-gamepad"></i>Game</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-life">
      
    

    <a href="/categories/Life/" rel="section"><i class="fa fa-fw fa-paw"></i>Life</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-topics">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Topics</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="fa fa-search fa-fw"></i>Search</a>
      </li>
    
  </ul>

    

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/10/notes-skill-database-mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Brielley">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brielley">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">MySQL Study Notes

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2020-01-10 15:14:00" itemprop="dateCreated datePublished" datetime="2020-01-10T15:14:00+08:00">2020-01-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-23 16:13:59" itemprop="dateModified" datetime="2021-03-23T16:13:59+08:00">2021-03-23</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Tech/Study-Notes/" itemprop="url" rel="index"><span itemprop="name">Study Notes</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>在Leetcode刷完了database下的所有免费题，尝试把这些题目按问题进行了分类，并梳理出每种问题的所涉MySQL知识点与解决思路。</p>
<h4 id="数据提取与分析"><a href="#数据提取与分析" class="headerlink" title="数据提取与分析"></a>数据提取与分析</h4><h5 id="问题1-前几"><a href="#问题1-前几" class="headerlink" title="问题1 前几"></a>问题1 前几</h5><p>【涉及知识点】<br>最值：单列最大<code>max(column)</code>，单列最小<code>min(column)</code>；多列最大<code>greatest(column1,column2)</code>，多列最小<code>least(column1,column2)</code>，注意greatest和least里不能有值为null否则会返回null<br>剔重：<code>distinct</code><br>排序：按某column列从小到大<code>order by column</code>，从大到小<code>order by column desc</code><br>选取：<code>limit m offset n</code> 取第n+1至n+1+(m-1)=n+m名<br>没有结果时返回null：嵌套一层，内层没有结果什么也不会返回，外层在内层没有结果的情况下会返回null，也可以外层用<code>ifnull</code>更直观</p>
<p>【例题】#176 <a href="https://leetcode.com/problems/second-highest-salary/" target="_blank" rel="noopener">Second Highest Salary</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Write a SQL query to get the second highest salary from the Employee table.</span><br><span class="line"></span><br><span class="line">+----+--------+</span><br><span class="line">| Id | Salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line">+----+--------+</span><br><span class="line">For example, given the above Employee table, the query should <span class="built_in">return</span> 200 as the second highest salary. </span><br><span class="line">If there is no second highest salary, <span class="keyword">then</span> the query should <span class="built_in">return</span> null.</span><br><span class="line"></span><br><span class="line">+---------------------+</span><br><span class="line">| SecondHighestSalary |</span><br><span class="line">+---------------------+</span><br><span class="line">| 200                 |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>

<p>【解析】<br>两种思路：一种是从高到低排序，然后取第二个，这种是如果要取的不是第二，而是第五或者第八到十都会比较适用的；另一种是先求最高的，然后求小于最高的那个，这种方法只在求第二的时候好使。</p>
<p>第二种思路的核心函数是max，求次高的时候可以用&lt;，也可以用not in，分别如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select max(salary) as <span class="string">'SecondHighestSalary'</span></span><br><span class="line">from employee</span><br><span class="line"><span class="built_in">where</span> salary &lt; (select max(salary) from employee)</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select max(salary) as <span class="string">'SecondHighestSalary'</span></span><br><span class="line">from employee</span><br><span class="line"><span class="built_in">where</span> salary not <span class="keyword">in</span> (select max(salary) from employee)</span><br></pre></td></tr></table></figure>

<p>备注:<br>1）其中前者运行时间是473ms，后者是229ms，后者比前者要快一些，事实上，大部分时候用where in都会更快。<br>2）虽然有函数，但没有group by，所以用where而不是having。<br>3）不用group by是因为是算的所有salary的top2，而不是按照某标准比如部门分组后计算每一组的salary的top2。</p>
<p>第一种思路的核心语句是order by desc和limit offset，无取值时返回null可以嵌套一层select也可以用ifnull，分别如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">   (</span><br><span class="line">    select distinct salary</span><br><span class="line">    from employee</span><br><span class="line">    order by salary desc</span><br><span class="line">    <span class="built_in">limit</span> 1 offset 1</span><br><span class="line">    )</span><br><span class="line">    as <span class="string">'SecondHighestSalary'</span></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select ifnull(</span><br><span class="line">               (select distinct salary</span><br><span class="line">                from employee</span><br><span class="line">                order by salary desc</span><br><span class="line">                <span class="built_in">limit</span> 1 offset 1)</span><br><span class="line">               ,null</span><br><span class="line">              )  </span><br><span class="line">              as <span class="string">'SecondHighestSalary'</span></span><br></pre></td></tr></table></figure>

<p>备注：<br>1）其中前者运行时间是430ms，后者运行时间是181ms，后者更快。<br>2）嵌套的外层是<code>select () as XXX</code>, 而不是<code>select xxx as XXX from () as t</code>，因为如果是后者的话，可以看到它的结构和内层一样，在没有值的时候返回的还是<code>[]</code>而不是<code>[null]</code>。</p>
<p>【例题】#184 <a href="https://leetcode.com/problems/department-highest-salary/" target="_blank" rel="noopener">Department Highest Salary</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">The Employee table holds all employees. Every employee has an Id, a salary, </span><br><span class="line">and there is also a column <span class="keyword">for</span> the department Id.</span><br><span class="line"></span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| 1  | Joe   | 70000  | 1            |</span><br><span class="line">| 2  | Jim   | 90000  | 1            |</span><br><span class="line">| 3  | Henry | 80000  | 2            |</span><br><span class="line">| 4  | Sam   | 60000  | 2            |</span><br><span class="line">| 5  | Max   | 90000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">The Department table holds all departments of the company.</span><br><span class="line"></span><br><span class="line">+----+----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line">+----+----------+</span><br><span class="line">Write a SQL query to find employees who have the highest salary <span class="keyword">in</span> each of the departments. </span><br><span class="line">For the above tables, your SQL query should <span class="built_in">return</span> the following rows (order of rows does not matter).</span><br><span class="line"></span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| Department | Employee | Salary |</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| IT         | Max      | 90000  |</span><br><span class="line">| IT         | Jim      | 90000  |</span><br><span class="line">| Sales      | Henry    | 80000  |</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">Explanation:</span><br><span class="line"></span><br><span class="line">Max and Jim both have the highest salary <span class="keyword">in</span> the IT department </span><br><span class="line">and Henry has the highest salary <span class="keyword">in</span> the Sales department.</span><br></pre></td></tr></table></figure>

<p>【解析】<br>由于需要把所有并列部门第一的信息全部罗列出来，因此不能简单地group by部门以后倒序排列然后limit 1，而是需要嵌套一层，选出所有数值等于前者的，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select d.name as <span class="string">'Department'</span>,</span><br><span class="line">       e.name as <span class="string">'Employee'</span>,</span><br><span class="line">       e.Salary</span><br><span class="line">from employee e</span><br><span class="line">join department d</span><br><span class="line">on d.id=e.departmentid</span><br><span class="line">join (select max(salary) as mxsalary, departmentid from employee group by departmentid) mx</span><br><span class="line">on mx.mxsalary=e.salary and mx.departmentid=e.departmentid</span><br></pre></td></tr></table></figure>

<p>【例题】#185 <a href="https://leetcode.com/problems/department-top-three-salaries/" target="_blank" rel="noopener">Department Top Three Salaries</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">The Employee table holds all employees. Every employee has an Id, </span><br><span class="line">and there is also a column <span class="keyword">for</span> the department Id.</span><br><span class="line"></span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| 1  | Joe   | 85000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">| 5  | Janet | 69000  | 1            |</span><br><span class="line">| 6  | Randy | 85000  | 1            |</span><br><span class="line">| 7  | Will  | 70000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">The Department table holds all departments of the company.</span><br><span class="line"></span><br><span class="line">+----+----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line">+----+----------+</span><br><span class="line">Write a SQL query to find employees who earn the top three salaries <span class="keyword">in</span> each of the department. </span><br><span class="line">For the above tables, your SQL query should <span class="built_in">return</span> the following rows (order of rows does not matter).</span><br><span class="line"></span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| Department | Employee | Salary |</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| IT         | Max      | 90000  |</span><br><span class="line">| IT         | Randy    | 85000  |</span><br><span class="line">| IT         | Joe      | 85000  |</span><br><span class="line">| IT         | Will     | 70000  |</span><br><span class="line">| Sales      | Henry    | 80000  |</span><br><span class="line">| Sales      | Sam      | 60000  |</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">Explanation:</span><br><span class="line"></span><br><span class="line">In IT department, Max earns the highest salary, both Randy and Joe earn the second highest salary, </span><br><span class="line">and Will earns the third highest salary. There are only two employees <span class="keyword">in</span> the Sales department, </span><br><span class="line">Henry earns the highest salary <span class="keyword">while</span> Sam earns the second highest salary.</span><br></pre></td></tr></table></figure>

<p>【解析】<br>由于需要把满足条件的都列出来，而其中有并列的，因此需要把employee自己并表对比。核心思路是，每类比自己小的最多只有3个。具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select d.name as <span class="string">'Department'</span>,</span><br><span class="line">       e1.name as <span class="string">'Employee'</span>,</span><br><span class="line">       e1.Salary</span><br><span class="line">from employee e1</span><br><span class="line">join department d</span><br><span class="line">on e1.departmentid=d.id </span><br><span class="line">join employee e2</span><br><span class="line">on e1.departmentid=e2.departmentid </span><br><span class="line"><span class="built_in">where</span> e1.salary&lt;=e2.salary</span><br><span class="line">group by e1.id</span><br><span class="line">having count(distinct(e2.salary))&lt;=3</span><br></pre></td></tr></table></figure>

<p>注意:<br>group by的是id，而不是departmentid，这是因为e1和e2已经按照同departmentid来比较了，group by主要是为了后面的having count()，而不是为了区分部门。后面可以用e1.id或者e1.name，但不能用e2的id或name，也不能用departmentid或者salary。</p>
<h5 id="问题2-对比"><a href="#问题2-对比" class="headerlink" title="问题2 对比"></a>问题2 对比</h5><p>【涉及知识点】<br>核心思路：先拆表再并表，把表按照一个参数一个表拆为多个表，再对比或用join连接各表进行数值对比<br>并表：<code>select xxx from table1 join table2 join table3 on table1.column1=table2.column2 and table1.column3=table3.column4</code><br>拆表：<code>select xxx from table as t1, table as t2 where</code></p>
<p>【例题】#181 <a href="https://leetcode.com/problems/employees-earning-more-than-their-managers/solution/" target="_blank" rel="noopener">Employees Earning More Than Their Managers</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">The Employee table holds all employees including their managers. Every employee has an Id, </span><br><span class="line">and there is also a column <span class="keyword">for</span> the manager Id.</span><br><span class="line"></span><br><span class="line">+----+-------+--------+-----------+</span><br><span class="line">| Id | Name  | Salary | ManagerId |</span><br><span class="line">+----+-------+--------+-----------+</span><br><span class="line">| 1  | Joe   | 70000  | 3         |</span><br><span class="line">| 2  | Henry | 80000  | 4         |</span><br><span class="line">| 3  | Sam   | 60000  | NULL      |</span><br><span class="line">| 4  | Max   | 90000  | NULL      |</span><br><span class="line">+----+-------+--------+-----------+</span><br><span class="line">Given the Employee table, write a SQL query that finds out employees who earn more than their managers. </span><br><span class="line">For the above table, Joe is the only employee who earns more than his manager.</span><br><span class="line"></span><br><span class="line">+----------+</span><br><span class="line">| Employee |</span><br><span class="line">+----------+</span><br><span class="line">| Joe      |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure>

<p>【解析】<br>两种思路，一种是两个表直接对比，一种是并表对比，后者比前者用得更多，因为这个例题是只有两个参数，如果参数多了，并表更直观。</p>
<p>第一种思路直接对比，核心语句是where，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select e1.name as <span class="string">'Employee'</span></span><br><span class="line">from employee as e1,</span><br><span class="line">     employee as e2</span><br><span class="line"><span class="built_in">where</span> e1.managerid = e2.id</span><br><span class="line">and e1.salary &gt; e2.salary</span><br></pre></td></tr></table></figure>

<p>这种方法的运算时间是881ms，但不太常用，更常用的还是第二种思路join。</p>
<p>第二种思路先拆表再并表，核心语句是join，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select e1.name as <span class="string">'Employee'</span></span><br><span class="line">from employee as e1</span><br><span class="line">left join employee as e2</span><br><span class="line">on e1.managerid=e2.id</span><br><span class="line"><span class="built_in">where</span> e1.salary &gt; e2.salary</span><br></pre></td></tr></table></figure>

<p>这种方法的运算时间是792ms，比较常用，先拆表再并表是一种sql基本思路。</p>
<p>【例题】#601 <a href="https://leetcode.com/problems/human-traffic-of-stadium/" target="_blank" rel="noopener">Human Traffic of Stadium</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">X city built a new stadium, each day many people visit it and the stats are saved as these columns: </span><br><span class="line">id, visit_date, people</span><br><span class="line"></span><br><span class="line">Please write a query to display the records <span class="built_in">which</span> have 3 or more consecutive rows </span><br><span class="line">and the amount of people more than 100(inclusive).</span><br><span class="line"></span><br><span class="line">For example, the table stadium:</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">| id   | visit_date | people    |</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">| 1    | 2017-01-01 | 10        |</span><br><span class="line">| 2    | 2017-01-02 | 109       |</span><br><span class="line">| 3    | 2017-01-03 | 150       |</span><br><span class="line">| 4    | 2017-01-04 | 99        |</span><br><span class="line">| 5    | 2017-01-05 | 145       |</span><br><span class="line">| 6    | 2017-01-06 | 1455      |</span><br><span class="line">| 7    | 2017-01-07 | 199       |</span><br><span class="line">| 8    | 2017-01-08 | 188       |</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">For the sample data above, the output is:</span><br><span class="line"></span><br><span class="line">+------+------------+-----------+</span><br><span class="line">| id   | visit_date | people    |</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">| 5    | 2017-01-05 | 145       |</span><br><span class="line">| 6    | 2017-01-06 | 1455      |</span><br><span class="line">| 7    | 2017-01-07 | 199       |</span><br><span class="line">| 8    | 2017-01-08 | 188       |</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">Note:</span><br><span class="line">Each day only have one row record, and the dates are increasing with id increasing.</span><br></pre></td></tr></table></figure>

<p>【解析】<br>拆成3个表来对比即可，注意符合条件的id可能在连续3个100以上访问记录的第1/2/3个中的任何一个位置，需用or来连接条件，并用（）来表示优先级，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select distinct s1.*</span><br><span class="line">from stadium s1, stadium s2, stadium s3</span><br><span class="line"><span class="built_in">where</span> s1.people&gt;=100 and s2.people&gt;=100 and s3.people&gt;=100</span><br><span class="line">and ((s1.id+1=s2.id and s2.id+1=s3.id) </span><br><span class="line">     or </span><br><span class="line">     (s2.id+1=s1.id and s1.id+1=s3.id) </span><br><span class="line">     or </span><br><span class="line">     (s3.id+1=s2.id and s2.id+1=s1.id))</span><br><span class="line">order by id</span><br></pre></td></tr></table></figure>

<p>注意：由于很多id同时满足or连接的不同条件，因此<code>distinct</code>和<code>order by</code>是必须的。</p>
<h5 id="问题3-查重"><a href="#问题3-查重" class="headerlink" title="问题3 查重"></a>问题3 查重</h5><p>【涉及知识点】<br>分类：<code>group by</code><br>计数：<code>count()</code><br>先拆再比</p>
<p>【例题】#182 <a href="https://leetcode.com/problems/duplicate-emails/" target="_blank" rel="noopener">Duplicate Emails</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Write a SQL query to find all duplicate emails <span class="keyword">in</span> a table named Person.</span><br><span class="line"></span><br><span class="line">+----+---------+</span><br><span class="line">| Id | Email   |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | a@b.com |</span><br><span class="line">| 2  | c@d.com |</span><br><span class="line">| 3  | a@b.com |</span><br><span class="line">+----+---------+</span><br><span class="line">For example, your query should <span class="built_in">return</span> the following <span class="keyword">for</span> the above table:</span><br><span class="line"></span><br><span class="line">+---------+</span><br><span class="line">| Email   |</span><br><span class="line">+---------+</span><br><span class="line">| a@b.com |</span><br><span class="line">+---------+</span><br><span class="line">Note: All emails are <span class="keyword">in</span> lowercase.</span><br></pre></td></tr></table></figure>

<p>【解析】<br>两种思路，一种思路是转化为对比问题，用上面问题2对比中所用的先拆再比的办法，另一种思路是每个email分个类，选出分类计数大于1的。</p>
<p>第一种思路，拆成两个表，求那些id不同但email值相同的，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select distinct p1.Email</span><br><span class="line">from person p1,</span><br><span class="line">     person p2</span><br><span class="line"><span class="built_in">where</span> p1.id &lt;&gt; p2.id</span><br><span class="line">and p1.email = p2.email</span><br></pre></td></tr></table></figure>

<p>备注：<br>1）这种方法的运算速度是513ms<br>2）注意要用distinct，这样如果重复次数多于2次的时候，只会返回一个值。</p>
<p>另一种思路，按email进行分类，求类别下的id数大于1的，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select Email</span><br><span class="line">from person</span><br><span class="line">group by email</span><br><span class="line">having count(email) &gt; 1</span><br></pre></td></tr></table></figure>

<p>备注：<br>1）这种方法的运算速度是436ms<br>2）注意因为有分类<code>group by</code>，求每个类别的计数条件要用<code>having</code>，而不是求所有的计数所用的<code>where</code>。<br>3）计数这种方式比起前一种拆表对比的方式而言，适用性更强，在有多个参数有要求时更方便直观。</p>
<p>【例题】#596 <a href="https://leetcode.com/problems/classes-more-than-5-students/" target="_blank" rel="noopener">Classes More Than 5 Students</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">There is a table courses with columns: student and class</span><br><span class="line"></span><br><span class="line">Please list out all classes <span class="built_in">which</span> have more than or equal to 5 students.</span><br><span class="line"></span><br><span class="line">For example, the table:</span><br><span class="line"></span><br><span class="line">+---------+------------+</span><br><span class="line">| student | class      |</span><br><span class="line">+---------+------------+</span><br><span class="line">| A       | Math       |</span><br><span class="line">| B       | English    |</span><br><span class="line">| C       | Math       |</span><br><span class="line">| D       | Biology    |</span><br><span class="line">| E       | Math       |</span><br><span class="line">| F       | Computer   |</span><br><span class="line">| G       | Math       |</span><br><span class="line">| H       | Math       |</span><br><span class="line">| I       | Math       |</span><br><span class="line">+---------+------------+</span><br><span class="line">Should output:</span><br><span class="line"></span><br><span class="line">+---------+</span><br><span class="line">| class   |</span><br><span class="line">+---------+</span><br><span class="line">| Math    |</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Note:</span><br><span class="line">The students should not be counted duplicate <span class="keyword">in</span> each course.</span><br></pre></td></tr></table></figure>

<p>【解析】<br>这样计数超过2的情况用对比就不好使了，用group by再count则非常方便。具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select class</span><br><span class="line">from courses</span><br><span class="line">group by class</span><br><span class="line">having count(distinct student)&gt;=5</span><br></pre></td></tr></table></figure>

<p>备注：<br>1）同上例，因为有<code>group by</code>，所以不能用<code>where</code>，而应该用<code>having</code>来求每组的数字<br>2）考虑到表中有可能有不同口径重复写入的情况，因此需要<code>distinct</code>剔除重复的记录，最好养成加distinct的习惯，因为如果没有重复记录，加一个distinct也不会影响结果。</p>
<h5 id="问题4-日期"><a href="#问题4-日期" class="headerlink" title="问题4 日期"></a>问题4 日期</h5><p>【涉及知识点】<br><strong>返回当前日期和时间</strong>：<br><code>now()</code>会返回当前YYYY-MM-DD HH:MM:SS，<br><code>curdate()</code>会返回当前YYYY-MM-DD，<br><code>curtime()</code>会返回当前HH:MM:SS<br><strong>截取时间中的某个值</strong>：<br><code>date(column)</code>会返回column中的YYYY-MM-DD，<br><code>extract(year/quarter/month/week/day/hour/minute/second/microsecond/hour_minute/day_minute/year_month from column)</code>会返回column中的YYYY/Q/MM/WW/DD/HH/MM/SS/MS/HHMM/DDHHMM/YYYYMM 注，Q是从1开始计，WW是在第一个周日前计为0，第一个周日开始到第一个周六计为1，以此类推<br><strong>增减求日期间隔</strong>：<br><code>date_add(date, interval 1 day/week/month/quarter/year/hour/minute/second)</code>返回date之后1天/周/月/季/年/小时/分钟/秒钟后的那个日期，<br><code>date_sub(date, interval 2 day/...)</code>返回date之前1天/…后的那个日期，<br><code>datediff(date1,date2)</code>返回两个日期中间的间隔<strong>天</strong>数。</p>
<p>【例题】#197 <a href="https://leetcode.com/problems/rising-temperature/" target="_blank" rel="noopener">Rising Temperature</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Given a Weather table, write a SQL query to find all dates<span class="string">' Ids </span></span><br><span class="line"><span class="string">with higher temperature compared to its previous (yesterday'</span>s) dates.</span><br><span class="line"></span><br><span class="line">+---------+------------------+------------------+</span><br><span class="line">| Id(INT) | RecordDate(DATE) | Temperature(INT) |</span><br><span class="line">+---------+------------------+------------------+</span><br><span class="line">|       1 |       2015-01-01 |               10 |</span><br><span class="line">|       2 |       2015-01-02 |               25 |</span><br><span class="line">|       3 |       2015-01-03 |               20 |</span><br><span class="line">|       4 |       2015-01-04 |               30 |</span><br><span class="line">+---------+------------------+------------------+</span><br><span class="line">For example, <span class="built_in">return</span> the following Ids <span class="keyword">for</span> the above Weather table:</span><br><span class="line"></span><br><span class="line">+----+</span><br><span class="line">| Id |</span><br><span class="line">+----+</span><br><span class="line">|  2 |</span><br><span class="line">|  4 |</span><br><span class="line">+----+</span><br></pre></td></tr></table></figure>

<p>【解析】<br>主体是一个非常简单的先拆表再比较或并表，容易错的点在于：由于记录不一定是连续的，所以不能用id而应该用recorddate来表达previous dates的概念，用到<code>date_add</code>或<code>datediff</code>函数，具体如下：<br>date_add+拆表比较（运算时间1025ms）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select w2.Id </span><br><span class="line">from weather w1, </span><br><span class="line">     weather w2</span><br><span class="line"><span class="built_in">where</span> date_add(w1.recorddate, interval 1 day)=w2.recorddate </span><br><span class="line">and w1.temperature&lt;w2.temperature</span><br></pre></td></tr></table></figure>

<p>datediff+拆表比较（运算时间641ms）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select w2.Id </span><br><span class="line">from weather w1, </span><br><span class="line">     weather w2</span><br><span class="line"><span class="built_in">where</span> datediff(w1.recorddate, w2.recorddate)=-1 </span><br><span class="line">and w1.temperature&lt;w2.temperature</span><br></pre></td></tr></table></figure>

<p>date_add+拆表并表（运算时间679ms)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select w2.Id </span><br><span class="line">from weather w1</span><br><span class="line">right join weather w2</span><br><span class="line">on date_add(w1.recorddate,interval 1 day)=w2.recorddate</span><br><span class="line"><span class="built_in">where</span> w1.temperature&lt;w2.temperature</span><br></pre></td></tr></table></figure>

<p>datediff+拆表并表（运算时间791ms）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select w2.Id </span><br><span class="line">from weather w1</span><br><span class="line">right join weather w2</span><br><span class="line">on datediff(w1.recorddate, w2.recorddate)=-1 </span><br><span class="line"><span class="built_in">where</span> w1.temperature&lt;w2.temperature</span><br></pre></td></tr></table></figure>

<p>从运算时间看，其中如果采用并表join，用date_add更快一点；如果采用比较，用datediff要快很多。<br>考虑到大部分情况下用join会比直接比较更适合多参数拆分为多表时，因此在date_add和datediff都能用的情况下可考虑优先选用date_add。</p>
<h5 id="问题5-数字"><a href="#问题5-数字" class="headerlink" title="问题5 数字"></a>问题5 数字</h5><p>【涉及知识点】<br><strong>一些常用符号</strong>：<br>不等于可以用<code>&lt;&gt;</code>也可以用<code>!=</code>；<br>余数可以用<code>mod(被除数,除数)=余数</code>也可以用<code>被除数%除数=余数</code>；<br><strong>截取数字</strong>：<br><code>round(3.1415, 3)</code>=3.142，<br><code>truncate(3.1415, 3)</code>=3.141，<br><code>floor(3.1415)</code>=3，<br><code>ceil(3.1415)</code>=4</p>
<p>【例题】#620 <a href="https://leetcode.com/problems/not-boring-movies/" target="_blank" rel="noopener">Not Boring Movies</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">X city opened a new cinema, many people would like to go to this cinema. </span><br><span class="line">The cinema also gives out a poster indicating the movies’ ratings and descriptions.</span><br><span class="line">Please write a SQL query to output movies with an odd numbered ID and a description </span><br><span class="line">that is not <span class="string">'boring'</span>. Order the result by rating.</span><br><span class="line"></span><br><span class="line">For example, table cinema:</span><br><span class="line"></span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">|   2     | Science   |   fiction    |   8.5     |</span><br><span class="line">|   3     | irish     |   boring     |   6.2     |</span><br><span class="line">|   4     | Ice song  |   Fantacy    |   8.6     |</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">For the example above, the output should be:</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br></pre></td></tr></table></figure>

<p>【解析】 这道题非常简单，仅需知道余数的表达方式即可，余数用<code>%</code>则只有mysql支持，用<code>mod()</code>则其它如oracle等也支持，这道题的description里的boring是精确的，可以直接用<code>=</code>，但考虑到大部分时候描述和评价会是一小段话而非一个词，因此用了字符串模糊匹配的<code>not like &#39;%xxx%&#39;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * </span><br><span class="line">from cinema</span><br><span class="line"><span class="built_in">where</span> id%2=1</span><br><span class="line">and description not like <span class="string">'%boring%'</span></span><br><span class="line">order by rating desc</span><br></pre></td></tr></table></figure>

<h5 id="问题6-字符"><a href="#问题6-字符" class="headerlink" title="问题6 字符"></a>问题6 字符</h5><p>【涉及知识点】<br><strong>字符串匹配</strong>：<br>精确匹配用<code>=</code>，模糊匹配用<code>like</code>或<code>not like</code>，<br>模糊匹配不确定前后有多少字符的时候用<code>&#39;%word%&#39;</code>，模糊匹配确定前后有多少个字符的时候用<code>&#39;w_rd&#39;</code>，<br>模糊匹配多个可以包含的字符时用<code>&#39;where city like [ANL]%&#39;</code>，即返回所有以A或N或L字母打头的城市名，<br>模糊匹配多个需要排除的字符时用<code>&#39;where city like [!ANL]&#39;</code>，即返回所有<strong>不</strong>以A或N或L字母打头的城市名。<br><strong>字符串长度</strong>：<br><code>len(column)</code>，返回这列每个值的字符串长度<br><strong>字符串定位</strong>：<br><code>locate(abc, column)</code>，返回这列每个值中，字符abc出现的位置，如无返回0<br><strong>截取字符串</strong>：<br><code>mid(column, x, n)</code>，返回这列每个值中，从第x个字符开始一直截取n个字符的这一串子字符串</p>
<p>【例题】<br>问题5的例题262、问题11的例题620解析中有涉及到字符串处理，不赘述。</p>
<h5 id="问题7-替换"><a href="#问题7-替换" class="headerlink" title="问题7 替换"></a>问题7 替换</h5><p>【涉及知识点】<br>替换问题的核心其实是多条件赋值，如果只有较少条件的时候可以用<code>if()</code>，如果条件多时需要用<code>case when</code><br><strong>if的基本用法</strong>：<code>if(条件, 符合条件时的赋值1, 不符合条件时的赋值2)</code><br><strong>case when的基本用法</strong>：<code>case when 条件1 then 赋值1 when 条件2 then 赋值2 else 赋值3 end</code></p>
<p>【例题】#627 <a href="https://leetcode.com/problems/swap-salary/" target="_blank" rel="noopener">Swap Salary</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Given a table salary, such as the one below, that has m=male and f=female values. </span><br><span class="line">Swap all f and m values (i.e., change all f values to m and vice versa) with a single update statement </span><br><span class="line">and no intermediate temp table.</span><br><span class="line"></span><br><span class="line">Note that you must write a single update statement, DO NOT write any select statement <span class="keyword">for</span> this problem.</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line"></span><br><span class="line">| id | name | sex | salary |</span><br><span class="line">|----|------|-----|--------|</span><br><span class="line">| 1  | A    | m   | 2500   |</span><br><span class="line">| 2  | B    | f   | 1500   |</span><br><span class="line">| 3  | C    | m   | 5500   |</span><br><span class="line">| 4  | D    | f   | 500    |</span><br><span class="line"></span><br><span class="line">After running your update statement, the above salary table should have the following rows:</span><br><span class="line"></span><br><span class="line">| id | name | sex | salary |</span><br><span class="line">|----|------|-----|--------|</span><br><span class="line">| 1  | A    | f   | 2500   |</span><br><span class="line">| 2  | B    | m   | 1500   |</span><br><span class="line">| 3  | C    | f   | 5500   |</span><br><span class="line">| 4  | D    | m   | 500    |</span><br></pre></td></tr></table></figure>

<p>【解析】<br>解题思路有两种，一种是用if，因为这里只有两个赋值，一种是用更具普遍性的case when。<br>需要额外提到的是，这是一个更新数据库而非通常的提取数据用于分析的场景，需要用到<code>update</code>而非日常的select，更新数据update的基本用法是：<code>update 表格名 set 需修改参数列名 = 修改内容</code></p>
<p>第一种思路，case when，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update salary </span><br><span class="line"><span class="built_in">set</span> sex = <span class="keyword">case</span> sex when <span class="string">'f'</span> <span class="keyword">then</span> <span class="string">'m'</span></span><br><span class="line">                   <span class="keyword">else</span> <span class="string">'f'</span></span><br><span class="line">          end</span><br></pre></td></tr></table></figure>

<p>需要注意的是，修改的列和条件的列都是sex，如果不是同一列的话比如修改的是name，用于判断的条件是id，那么会写作<code>update salary set name= case id when 1 then &#39;aaa&#39; when 2 then &#39;bbb&#39; else &#39;ccc&#39; end</code><br>另，如果不写作case sex when，而是直接用case when，把sex放到后面去也是可以的，具体写作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">update salary</span><br><span class="line"><span class="built_in">set</span> sex = <span class="keyword">case</span> when sex=<span class="string">'f'</span></span><br><span class="line">               <span class="keyword">then</span> <span class="string">'m'</span></span><br><span class="line">               <span class="keyword">else</span> <span class="string">'f'</span></span><br><span class="line">          end</span><br></pre></td></tr></table></figure>

<p>第二种思路，if，因为这里sex只有两个取值，所以用if是足够的，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update salary </span><br><span class="line"><span class="built_in">set</span> sex = <span class="keyword">if</span>(sex=<span class="string">'f'</span>,<span class="string">'m'</span>,<span class="string">'f'</span>)</span><br></pre></td></tr></table></figure>

<p>需要注意的是，if后面的条件必须完整的写为sex=xxx，而不能因为前面已经有sex=了就省掉，因为这里的条件和要赋值的列都是sex，但可能存在不是同一个列的情况，比如按照上面的栗子会写作<code>update salary set name = if(id=1,&#39;aaa&#39;,&#39;bbb&#39;)</code></p>
<p>这里用if的运算时间是518ms，用case when的运算时间是337ms，尽管if的代码要短一些，但case when的运算速度更快，考虑到case when的适用场景也更多，因此在替换与赋值问题中尽量优先选择使用case when。</p>
<p>【例题】#626 <a href="https://leetcode.com/problems/exchange-seats/" target="_blank" rel="noopener">Exchange Seats</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Mary is a teacher <span class="keyword">in</span> a middle school and she has a table seat storing students<span class="string">' names </span></span><br><span class="line"><span class="string">and their corresponding seat ids.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The column id is continuous increment.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">Mary wants to change seats for the adjacent students.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">Can you write a SQL query to output the result for Mary?</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">+---------+---------+</span></span><br><span class="line"><span class="string">|    id   | student |</span></span><br><span class="line"><span class="string">+---------+---------+</span></span><br><span class="line"><span class="string">|    1    | Abbot   |</span></span><br><span class="line"><span class="string">|    2    | Doris   |</span></span><br><span class="line"><span class="string">|    3    | Emerson |</span></span><br><span class="line"><span class="string">|    4    | Green   |</span></span><br><span class="line"><span class="string">|    5    | Jeames  |</span></span><br><span class="line"><span class="string">+---------+---------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For the sample input, the output is:</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">+---------+---------+</span></span><br><span class="line"><span class="string">|    id   | student |</span></span><br><span class="line"><span class="string">+---------+---------+</span></span><br><span class="line"><span class="string">|    1    | Doris   |</span></span><br><span class="line"><span class="string">|    2    | Abbot   |</span></span><br><span class="line"><span class="string">|    3    | Green   |</span></span><br><span class="line"><span class="string">|    4    | Emerson |</span></span><br><span class="line"><span class="string">|    5    | Jeames  |</span></span><br><span class="line"><span class="string">+---------+---------+</span></span><br><span class="line"><span class="string">Note:</span></span><br><span class="line"><span class="string">If the number of students is odd, there is no need to change the last one'</span>s seat.</span><br></pre></td></tr></table></figure>

<p>【解析】<br>由于涉及到3个情景：奇数且不为最大值，奇数且为最大值，偶数。因此无法用if，需用case when，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">      (<span class="keyword">case</span> when id%2=0 <span class="keyword">then</span> id-1</span><br><span class="line">            when id%2=1 and id&lt;&gt;maxid <span class="keyword">then</span> id+1</span><br><span class="line">            <span class="keyword">else</span> id</span><br><span class="line">       end</span><br><span class="line">       ) as id,</span><br><span class="line">       student</span><br><span class="line">from seat,</span><br><span class="line">     (select max(id) as maxid from seat) mx</span><br><span class="line">order by id</span><br></pre></td></tr></table></figure>

<p>注意：<br>不能在case when的其中一个枝干里直接用<code>case when id%2=1 and id not in (select max(id) from seat) mx then id+1</code>，而须按照上面的写法把mx放到from之后，否则会报错。</p>
<h5 id="问题8-扩表"><a href="#问题8-扩表" class="headerlink" title="问题8 扩表"></a>问题8 扩表</h5><p>【涉及知识点】<br>扩表是把记录不连续的表格扩大成包含一系列参数的大表，通常包含两类操作：列转行或行转列、对无记录的条目进行赋值<br>列转行通常有三种做法：<code>if</code>；<code>case when</code>；<code>pivot</code><br>行转列通常做法为：<code>union</code>/<code>union all</code><br>if和case when的用法在问题7替换中已经讲过了，不赘述。<br>pivot的基本用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select column2value1,column2value2,column2value3</span><br><span class="line">from (select * from originaltable) as base</span><br><span class="line">pivot(max/min/sum(column1) <span class="keyword">for</span> column2 <span class="keyword">in</span> (column2value1,column2value2,column2value3)) as pvt</span><br></pre></td></tr></table></figure>

<p>union /union all基本用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select column from table</span><br><span class="line">union (all)</span><br><span class="line">select column from table</span><br></pre></td></tr></table></figure>

<p>需注意的是，1）如果用union会自动剃重，union all则不会 2）被连接各表的colomn项目顺序格式必须完全一样 3）union除了用作行转列外，也可用作纵向并表（join为横向并表）</p>
<p>【例题】#1179 <a href="https://leetcode.com/problems/reformat-department-table/" target="_blank" rel="noopener">Reformat Department Table</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Table: Department</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| revenue       | int     |</span><br><span class="line">| month         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, month) is the primary key of this table.</span><br><span class="line">The table has information about the revenue of each department per month.</span><br><span class="line">The month has values <span class="keyword">in</span> [<span class="string">"Jan"</span>,<span class="string">"Feb"</span>,<span class="string">"Mar"</span>,<span class="string">"Apr"</span>,<span class="string">"May"</span>,<span class="string">"Jun"</span>,<span class="string">"Jul"</span>,<span class="string">"Aug"</span>,<span class="string">"Sep"</span>,<span class="string">"Oct"</span>,<span class="string">"Nov"</span>,<span class="string">"Dec"</span>].</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query to reformat the table such that there is a department id column </span><br><span class="line">and a revenue column <span class="keyword">for</span> each month.</span><br><span class="line"></span><br><span class="line">The query result format is <span class="keyword">in</span> the following example:</span><br><span class="line"></span><br><span class="line">Department table:</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| id   | revenue | month |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| 1    | 8000    | Jan   |</span><br><span class="line">| 2    | 9000    | Jan   |</span><br><span class="line">| 3    | 10000   | Feb   |</span><br><span class="line">| 1    | 7000    | Feb   |</span><br><span class="line">| 1    | 6000    | Mar   |</span><br><span class="line">+------+---------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| id   | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| 1    | 8000        | 7000        | 6000        | ... | null        |</span><br><span class="line">| 2    | 9000        | null        | null        | ... | null        |</span><br><span class="line">| 3    | null        | 10000       | null        | ... | null        |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line"></span><br><span class="line">Note that the result table has 13 columns (1 <span class="keyword">for</span> the department id + 12 <span class="keyword">for</span> the months).</span><br></pre></td></tr></table></figure>

<p>【解析】<br>这是一个典型的扩表问题，需要的工作包含列转行和对没有记录的取值赋值为null，下面分别用case when；if；pivot来实现。<br>第一种方法，case when，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select distinct id,</span><br><span class="line">       sum(CASE when month=<span class="string">'jan'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Jan_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'feb'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Feb_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'mar'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Mar_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'apr'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Apr_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'may'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'May_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'jun'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Jun_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'jul'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Jul_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'aug'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Aug_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'sep'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Sep_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'oct'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Oct_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'nov'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Nov_Revenue'</span>,</span><br><span class="line">       sum(CASE when month=<span class="string">'dec'</span> <span class="keyword">then</span> revenue <span class="keyword">else</span> null END) as <span class="string">'Dec_Revenue'</span></span><br><span class="line">from department</span><br><span class="line">group by id</span><br></pre></td></tr></table></figure>

<p>备注：<br>1）需要注意的是用到了<code>sum()</code>和<code>group by id</code>，因为如果不用sum的话，就会出现每条记录对应的别的记录其实是有数值的会在这条记录中显示为null，因此需要用sum()或者max()来在多个取值中选择有数值的而非null，这道题目因为每个月每个部门只有一条记录，所以用max或者sum都可以，但如果是有多条记录的话，用sum()会更合适<br>2) 注意是<code>group by id</code>而不是<code>group by month</code>，因为已经把每个月给单独写出来了，不需要通过group by month来为不同月份分组计算，使用group by的目的是为了sum，因此需用id这种不会因group而汇总的参数。<br>3）distinct只是写作习惯，不写也可以，但实测发现写distinct的运算时间为690m，不写distinct会更慢运算时间要1116ms</p>
<p>第二种方法，if()函数，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select id,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'jan'</span>, revenue, null)) as <span class="string">'Jan_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'feb'</span>, revenue, null)) as <span class="string">'Feb_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'mar'</span>, revenue, null)) as <span class="string">'Mar_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'apr'</span>, revenue, null)) as <span class="string">'Apr_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'may'</span>, revenue, null)) as <span class="string">'May_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'jun'</span>, revenue, null)) as <span class="string">'Jun_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'jul'</span>, revenue, null)) as <span class="string">'Jul_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'aug'</span>, revenue, null)) as <span class="string">'Aug_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'sep'</span>, revenue, null)) as <span class="string">'Sep_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'oct'</span>, revenue, null)) as <span class="string">'Oct_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'nov'</span>, revenue, null)) as <span class="string">'Nov_Revenue'</span>,</span><br><span class="line">       sum(<span class="keyword">if</span>(month=<span class="string">'dec'</span>, revenue, null)) as <span class="string">'Dec_Revenue'</span></span><br><span class="line">from department</span><br><span class="line">group by id</span><br></pre></td></tr></table></figure>

<p>备注：<br>1）仍是用到了sum()和group by<br>2）这种方法运算时间为734ms，很有趣的是如果加distinct，运算时间为774ms，相差不大</p>
<p>第三种方法，pivot，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select id,</span><br><span class="line">       jan as Jan_revenue,</span><br><span class="line">       feb as Feb_revenue,</span><br><span class="line">       mar as Mar_revenue,</span><br><span class="line">       apr as Apr_revenue,</span><br><span class="line">       may as May_revenue,</span><br><span class="line">       jun as Jun_revenue,</span><br><span class="line">       jul as Jul_revenue,</span><br><span class="line">       aug as Aug_revenue,</span><br><span class="line">       sep as Sep_revenue,</span><br><span class="line">       oct as Oct_revenue,</span><br><span class="line">       nov as Nov_revenue,</span><br><span class="line">       dec as Dec_revenue</span><br><span class="line">from (select id,revenue,month from department) as base</span><br><span class="line">pivot (sum(revenue) <span class="keyword">for</span> month <span class="keyword">in</span>(jan,feb,mar,apr,may,jun,jul,aug,sep,oct,nov,dec)) as pvt</span><br></pre></td></tr></table></figure>

<p>备注：<br>1）大部分版本的mysql不支持pivot，以上是在ms sql server中的写法<br>2）运算时间1315ms<br>3）考虑兼容性，列转行尽量使用case when/if而非pivot，行转列尽量使用union all而非unpivot</p>
<h5 id="问题9-定义函数"><a href="#问题9-定义函数" class="headerlink" title="问题9 定义函数"></a>问题9 定义函数</h5><p>【涉及知识点】<br>有时需要返回的内容并非一个固定参数，而是会需要根据情况调整输入参数的，这时需要定义函数。<br>定义函数的基本格式为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION functionname(n int/varchar) RETURNS int/varchar <span class="comment">#定义functionname函数，参数n，参数格式是数字/字符，返回值是数字/字符</span></span><br><span class="line">BEGIN <span class="comment">#定义的参数不能表达为数学式，如有计算需要需设定其它参数并定义其与参数n的关系</span></span><br><span class="line">      DECLARE 参数名m 参数格式int; <span class="comment">#与定义函数名和参数格式时一样中间用空格隔开，注意结尾需:</span></span><br><span class="line">      SET m=n+1; <span class="comment">#set后面是declare的参数与函数参数n的关系，注意需;结尾</span></span><br><span class="line">  RETURN (  select... ); <span class="comment">#中间是正常的查询分析语句，把平时固定的某数值替换为函数参数n即可，</span></span><br><span class="line">                         <span class="comment">#注意需打括号，括号后有;，注意是return而不是前面定义函数名时用的returns</span></span><br><span class="line">END; <span class="comment">#注意有begin就要有end，end后面有没有;都可以</span></span><br></pre></td></tr></table></figure>

<p>【例题】#177 <a href="https://leetcode.com/problems/nth-highest-salary/" target="_blank" rel="noopener">Nth Highest Salary</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Write a SQL query to get the nth highest salary from the Employee table.</span><br><span class="line"></span><br><span class="line">+----+--------+</span><br><span class="line">| Id | Salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line">+----+--------+</span><br><span class="line">For example, given the above Employee table, the nth highest salary <span class="built_in">where</span> n = 2 is 200.</span><br><span class="line"> If there is no nth highest salary, <span class="keyword">then</span> the query should <span class="built_in">return</span> null.</span><br><span class="line"></span><br><span class="line">+------------------------+</span><br><span class="line">| getNthHighestSalary(2) |</span><br><span class="line">+------------------------+</span><br><span class="line">| 200                    |</span><br><span class="line">+------------------------+</span><br></pre></td></tr></table></figure>

<p>【解析】<br>本身是一个非常简单的前几问题，但由于需要定义一个函数来方便输入第几的数字，因此需要把简单的前几查询略作修改变成函数定义。具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION getNthHighestSalary(N int) RETURNS int</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line"> DECLARE M int;</span><br><span class="line"> SET M=N-1;</span><br><span class="line"></span><br><span class="line"> RETURN</span><br><span class="line"> (</span><br><span class="line">      select distinct salary</span><br><span class="line">      from employee</span><br><span class="line">      order by salary desc</span><br><span class="line">      <span class="built_in">limit</span> 1 offset M</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>格式中需要注意的点包括：<br>1）函数名的名字就是需要返回的列名，下面写函数时就无需as了<br>2）函数名后面括号内的参数名和参数格式中间的是空格，而不是逗号<br>3）定义函数名时用的returns有个s，后面接的是返回值的格式<br>4）create function returns这句后面无需使用符号<br>5）begin后如果没什么要设定的可以直接接return<br>6）如果在查询语句中不能直接使用参数而需要参数的计算后变形，那么需要在begin后先declare另一个辅助参数，然后set辅助参数与函数参数之间的关系，注意declare句后和set句后均有;分号<br>7）return后面的如果是整个查询语句的话，需要把查询语句括号起来，注意括号后有;分号<br>8）最后别忘了有begin就会有end，而end后面有没有;都可以的</p>
<h5 id="问题10-排名"><a href="#问题10-排名" class="headerlink" title="问题10 排名"></a>问题10 排名</h5><p>【涉及知识点】<br>需要注意的是，这里所说的排名与排序不同，重点是需要为每行返回一个代表其名次的数字，这涉及到的核心功能仍是自定义函数，但不同于create function，这里的自定义函数是在查询语句中间实现的，也并不需要面向不同的输入参数。<br>通过自定义函数创建一列新的行序数字的基本格式是：<br><code>select table.*, @rownum:=@rownum+1 from table, (select @rownum:=0) as r</code></p>
<p>【例题】#178 <a href="https://leetcode.com/problems/rank-scores/" target="_blank" rel="noopener">Rank Scores</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Write a SQL query to rank scores. If there is a tie between two scores, both should have the same ranking. </span><br><span class="line">Note that after a tie, the next ranking number should be the next consecutive <span class="built_in">integer</span> value. </span><br><span class="line">In other words, there should be no <span class="string">"holes"</span> between ranks.</span><br><span class="line"></span><br><span class="line">+----+-------+</span><br><span class="line">| Id | Score |</span><br><span class="line">+----+-------+</span><br><span class="line">| 1  | 3.50  |</span><br><span class="line">| 2  | 3.65  |</span><br><span class="line">| 3  | 4.00  |</span><br><span class="line">| 4  | 3.85  |</span><br><span class="line">| 5  | 4.00  |</span><br><span class="line">| 6  | 3.65  |</span><br><span class="line">+----+-------+</span><br><span class="line">For example, given the above Scores table, your query should generate the following report (order </span><br><span class="line">  by highest score):</span><br><span class="line"></span><br><span class="line">+-------+------+</span><br><span class="line">| Score | Rank |</span><br><span class="line">+-------+------+</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 3.85  | 2    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.50  | 4    |</span><br><span class="line">+-------+------+</span><br></pre></td></tr></table></figure>

<p>【解析】<br>可以想到输出结果是由两个表并成的，一个表是每个分数对应的排名，这需要将分数剔重以后排序再通过自定义函数得出每行的行数数值，第二个表是包含相同分数的原始表格，需要按照分数从高到低排列。具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select s1.Score, s3.Rank</span><br><span class="line">from scores s1</span><br><span class="line">left join</span><br><span class="line">(</span><br><span class="line"> select s2.score, @rownum:=@rownum+1 as Rank </span><br><span class="line"> from (select distinct score from scores order by score desc) s2, (select @rownum:=0) r</span><br><span class="line">) s3</span><br><span class="line">on s1.score=s3.score</span><br><span class="line">order by rank</span><br></pre></td></tr></table></figure>

<p>需注意的是，对获取排名值的表需要嵌套一次，因为需要剔除重复的和排序，而如果不嵌套而是把distinct，order by，自定义rownum函数全放在同一层的话会报错。</p>
<h5 id="问题11-比率"><a href="#问题11-比率" class="headerlink" title="问题11 比率"></a>问题11 比率</h5><p>【涉及知识点】<br>拆表再并表<br>用case when将符合条件的赋值1，不符合条件的赋值0，使用sum计算出所有符合条件的，除以count全部。</p>
<p>【例题】#262 <a href="https://leetcode.com/problems/trips-and-users/" target="_blank" rel="noopener">Trips and Users</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">The Trips table holds all taxi trips. Each trip has a unique Id, <span class="keyword">while</span> Client_Id and Driver_Id </span><br><span class="line">are both foreign keys to the Users_Id at the Users table. Status is an ENUM <span class="built_in">type</span> of (‘completed’, </span><br><span class="line">  ‘cancelled_by_driver’, ‘cancelled_by_client’).</span><br><span class="line"></span><br><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br><span class="line">| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|</span><br><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br><span class="line">| 1  |     1     |    10     |    1    |     completed      |2013-10-01|</span><br><span class="line">| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|</span><br><span class="line">| 3  |     3     |    12     |    6    |     completed      |2013-10-01|</span><br><span class="line">| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|</span><br><span class="line">| 5  |     1     |    10     |    1    |     completed      |2013-10-02|</span><br><span class="line">| 6  |     2     |    11     |    6    |     completed      |2013-10-02|</span><br><span class="line">| 7  |     3     |    12     |    6    |     completed      |2013-10-02|</span><br><span class="line">| 8  |     2     |    12     |    12   |     completed      |2013-10-03|</span><br><span class="line">| 9  |     3     |    10     |    12   |     completed      |2013-10-03| </span><br><span class="line">| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|</span><br><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br><span class="line">The Users table holds all users. Each user has an unique Users_Id, and Role is an ENUM </span><br><span class="line"> <span class="built_in">type</span> of (‘client’, ‘driver’, ‘partner’).</span><br><span class="line"></span><br><span class="line">+----------+--------+--------+</span><br><span class="line">| Users_Id | Banned |  Role  |</span><br><span class="line">+----------+--------+--------+</span><br><span class="line">|    1     |   No   | client |</span><br><span class="line">|    2     |   Yes  | client |</span><br><span class="line">|    3     |   No   | client |</span><br><span class="line">|    4     |   No   | client |</span><br><span class="line">|    10    |   No   | driver |</span><br><span class="line">|    11    |   No   | driver |</span><br><span class="line">|    12    |   No   | driver |</span><br><span class="line">|    13    |   No   | driver |</span><br><span class="line">+----------+--------+--------+</span><br><span class="line">Write a SQL query to find the cancellation rate of requests made by unbanned users (both client and </span><br><span class="line">driver must be unbanned) between Oct 1, 2013 and Oct 3, 2013. </span><br><span class="line">The cancellation rate is computed by dividing the number of canceled (by client or driver) requests </span><br><span class="line">made by unbanned users by the total number of requests made by unbanned users.</span><br><span class="line"></span><br><span class="line">For the above tables, your SQL query should <span class="built_in">return</span> the following rows with the cancellation rate </span><br><span class="line"> being rounded to two decimal places.</span><br><span class="line"></span><br><span class="line">+------------+-------------------+</span><br><span class="line">|     Day    | Cancellation Rate |</span><br><span class="line">+------------+-------------------+</span><br><span class="line">| 2013-10-01 |       0.33        |</span><br><span class="line">| 2013-10-02 |       0.00        |</span><br><span class="line">| 2013-10-03 |       0.50        |</span><br><span class="line">+------------+-------------------+</span><br></pre></td></tr></table></figure>

<p>【解析】<br>先并表，在并表过程中通过<code>where</code>把被禁用户和不符合日期的记录给直接剔除掉。<br>然后在求取消率时，分母可以直接用<code>count()</code>，分子如果用count就不能再设条件，因此用<code>sum()</code>，把符合条件带cancelled的条目赋值1其它赋值0，注意根据要求是精确到小数点后两位，因此需要用<code>round(num,2)</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select distinct t.request_at as <span class="string">'Day'</span>, </span><br><span class="line">       round(sum(<span class="keyword">case</span> when t.status like <span class="string">'%cancelled%'</span> <span class="keyword">then</span> 1 <span class="keyword">else</span> 0 end)/count(t.id), 2) as <span class="string">'Cancellation Rate'</span></span><br><span class="line">from trips t</span><br><span class="line">join users u1</span><br><span class="line">join users u2</span><br><span class="line">on t.client_id=u1.users_id and t.driver_id=u2.users_id</span><br><span class="line"><span class="built_in">where</span> u1.banned=<span class="string">'no'</span>and u2.banned=<span class="string">'no'</span> </span><br><span class="line">and t.request_at&gt;=<span class="string">'2013-10-01'</span> and t.request_at&lt;=<span class="string">'2013-10-03'</span></span><br><span class="line">group by request_at</span><br><span class="line">order by request_at</span><br></pre></td></tr></table></figure>

<p>注意：<br>1）<code>like</code>前面没有<code>is</code>，后面的模糊字符串需要用<code>&#39;&#39;</code>框起来。<br>2）三个表可以一起连，直接<code>join join on</code>，而无需<code>join on join on</code><br>3）日期可以直接用大于小于这样的符号，但需注意，日期也需用<code>&#39;&#39;</code>框起来，否则会报错。</p>
<h4 id="数据库维护相关"><a href="#数据库维护相关" class="headerlink" title="数据库维护相关"></a>数据库维护相关</h4><h5 id="问题1-删重"><a href="#问题1-删重" class="headerlink" title="问题1 删重"></a>问题1 删重</h5><p>【涉及知识点】<br>删除某行的格式：<code>delete * from table where</code>，和select的格式是一样的，只是换成delete，且因为是删整行，所以一般是<code>*</code>或者<code>table.*</code>而不像select需要写明选出来的是行里的哪些列参数。<br>删重还是剔重：一般原则上是不要删数据，用的时候选出不重复的就行了，也即是用distinct，但不排除有时确有删除数据库中的冗余数据的维护数据库而非从数据库中调用数据进行分析的情况。</p>
<p>【例题】#196 <a href="https://leetcode.com/problems/delete-duplicate-emails/" target="_blank" rel="noopener">Delete Duplicate Emails</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Write a SQL query to delete all duplicate email entries <span class="keyword">in</span> a table named Person, </span><br><span class="line">keeping only unique emails based on its smallest Id.</span><br><span class="line"></span><br><span class="line">+----+------------------+</span><br><span class="line">| Id | Email            |</span><br><span class="line">+----+------------------+</span><br><span class="line">| 1  | john@example.com |</span><br><span class="line">| 2  | bob@example.com  |</span><br><span class="line">| 3  | john@example.com |</span><br><span class="line">+----+------------------+</span><br><span class="line">Id is the primary key column <span class="keyword">for</span> this table.</span><br><span class="line">For example, after running your query, the above Person table should have the following rows:</span><br><span class="line"></span><br><span class="line">+----+------------------+</span><br><span class="line">| Id | Email            |</span><br><span class="line">+----+------------------+</span><br><span class="line">| 1  | john@example.com |</span><br><span class="line">| 2  | bob@example.com  |</span><br><span class="line">+----+------------------+</span><br><span class="line">Note:</span><br><span class="line"></span><br><span class="line">Your output is the whole Person table after executing your sql. Use delete statement.</span><br></pre></td></tr></table></figure>

<p>【解析】<br>和查重的思路很相似，也是要么先拆表再转化成比较问题，要么计算每个值有多少个。</p>
<p>第一种方法，拆表再对比，把查重时的select改为删除时的delete就行了，注意因为要求保留较小的一个id，因此比较的时候不是不等于而是大于。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delete p1.*</span><br><span class="line">from person p1,</span><br><span class="line">     person p2</span><br><span class="line"><span class="built_in">where</span> p1.id &gt; p2.id</span><br><span class="line">and p1.email = p2.email</span><br></pre></td></tr></table></figure>

<p>备注：<br>1）这种方法的运算时间是1110ms<br>2）这里的delete后面有<code>*</code>，是因为删除表格的依据是整表，而不是某个指标。</p>
<p>第二种方法，把表格按每个email来group by，然后这里我们不需要计数，只需要求出id最小的需要保留的是哪些，然后删除那些不属于这些id的就可以了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delete </span><br><span class="line">from person</span><br><span class="line"><span class="built_in">where</span> id not <span class="keyword">in</span> (</span><br><span class="line">                select id from</span><br><span class="line">                (select min(id) as <span class="string">'id'</span>,email</span><br><span class="line">                 from person</span><br><span class="line">                 group by email) minid</span><br></pre></td></tr></table></figure>

<p>备注：<br>1）这种方法的运算时间是1846ms<br>2）这里的delete后面没有<code>*</code>，而是直接接from，因为后面是where所限定的一个指标id<br>3）id not in的括号内必须嵌套一次，而不能直接一次，否则会报错，原因不明。</p>
<h5 id="问题2-更新数据"><a href="#问题2-更新数据" class="headerlink" title="问题2 更新数据"></a>问题2 更新数据</h5><p>【涉及知识点】<br>更新数据的基本格式：<br><code>update table set column-need-to-be-update=xxx where column-condition=mmm</code></p>
<p>【例题】 前面分析互换问题时在例题627中已经讲过，不赘述。</p>
<p>Credit: 以上所有例题题目均来自Leetcode免费题库，可点击每道例题的标题链接进入Leetcode练习。</p>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i> MySQL</a>
            
              <a href="/tags/Database/" rel="tag"><i class="fa fa-tag"></i> Database</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/01/09/review-annual-reading-repo-2019/" rel="next" title="2019 Annual Reading Repo">
                  <i class="fa fa-chevron-left"></i> 2019 Annual Reading Repo
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2020/03/01/translation-hp-ggad-35owls-01-16/" rel="prev" title="【翻译】三十五只猫头鹰的来信 （更新中）">
                  【翻译】三十五只猫头鹰的来信 （更新中） <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#数据提取与分析"><span class="nav-number">1.</span> <span class="nav-text">数据提取与分析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#问题1-前几"><span class="nav-number">1.1.</span> <span class="nav-text">问题1 前几</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题2-对比"><span class="nav-number">1.2.</span> <span class="nav-text">问题2 对比</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题3-查重"><span class="nav-number">1.3.</span> <span class="nav-text">问题3 查重</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题4-日期"><span class="nav-number">1.4.</span> <span class="nav-text">问题4 日期</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题5-数字"><span class="nav-number">1.5.</span> <span class="nav-text">问题5 数字</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题6-字符"><span class="nav-number">1.6.</span> <span class="nav-text">问题6 字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题7-替换"><span class="nav-number">1.7.</span> <span class="nav-text">问题7 替换</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题8-扩表"><span class="nav-number">1.8.</span> <span class="nav-text">问题8 扩表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题9-定义函数"><span class="nav-number">1.9.</span> <span class="nav-text">问题9 定义函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题10-排名"><span class="nav-number">1.10.</span> <span class="nav-text">问题10 排名</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题11-比率"><span class="nav-number">1.11.</span> <span class="nav-text">问题11 比率</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据库维护相关"><span class="nav-number">2.</span> <span class="nav-text">数据库维护相关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#问题1-删重"><span class="nav-number">2.1.</span> <span class="nav-text">问题1 删重</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#问题2-更新数据"><span class="nav-number">2.2.</span> <span class="nav-text">问题2 更新数据</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Brielley</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:brielley@163.com" title="Email Me &rarr; mailto:brielley@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>Email Me</a>
      </span>
    
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Brielley   All Rights Reserved</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/muse.js?v=7.4.0"></script>

<script src="/js/next-boot.js?v=7.4.0"></script>



  








  <script src="/js/local-search.js?v=7.4.0"></script>














  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '3a5d7f48d7abd0cc624f',
      clientSecret: '8f09323c8535bf597359196d51dca4821f547c44',
      repo: 'brielley.github.io',
      owner: 'brielley',
      admin: ['brielley'],
      id: 'b73d746cb0aaffcaf0ba2a1e342a0116',
        language: 'en',
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

</body>
</html>
